webpackJsonp([6],{W3nr:function(t,e){},ZTz9:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i={name:"freeListen",data:function(){var t=this;return{editModal:!1,subjectList:[],min_pic:"",table:{page:1,pagesize:10,total:0,editgroupId:0,columns:[{title:"序号",key:"location",width:130,align:"center"},{title:"图",key:"min_pic",align:"center",render:function(t,e){return[t("img",{attrs:{src:e.row.min_pic},style:{width:"100px"}})]}},{title:"课程名称",key:"title",width:130,align:"center"},{title:"音频数",key:"audio_num",align:"center"},{title:"操作",align:"center",render:function(e,a){return e("div",[e("i-switch",{attrs:{title:"0"==a.row.is_open?"未上架":"已上架"},props:{value:a.row.is_open+"",trueValue:"1",falseValue:"0"},on:{"on-change":function(e){t.changeStatus(a.row.lesson_id,e)}}}),e("i",{attrs:{class:"iconfont icon-edit"},on:{click:function(){t.showEditModal("edit",a.row),t.min_pic=a.row.min_pic}}}),e("i",{attrs:{class:"iconfont icon-delete"},style:{color:"#ffc639"},on:{click:function(){t.$Modal.warning({content:"确定删除该课程吗?",onOk:function(){t.$http.post(t.PATH.DEL_FREE_LESSON,{lesson_id_list:[a.row.lesson_id]}).then(function(e){t.getgroups(),t.getSubject()})}})}}})])}}],data:[]},formValidate:{type:"new",row:{},sort:"",title:"",subject:""},ruleValidate:{sort:[{required:!0,message:"序号",trigger:"blur"}],subject:[{required:!0,message:"请选择课程",trigger:"change"}],title:[{required:!0,message:"请输入标题",trigger:"blur"}]}}},methods:{handleChange:function(t){this.formValidate.title=t},modalChange:function(t){},withUpload:function(){document.getElementById("inputFile").click()},onUpload:function(t){var e=this,a=t.target.files||t.dataTransfer.files;if(a.length){var i=t.target.files[0].type;if(/^image/.test(i)){var n=new FileReader;n.readAsDataURL(a[0]),n.onload=function(){(new FormData).append("data",this.result);e.$post("/api/v1_0/uploadimage",{type:"jpg",data:this.result}).then(function(t){"0"==t.data.status?(e.min_pic=t.data.url,e.formValidate.pic=t.data.url):e.$Modal.error({title:"提示",content:t.data.msg})},function(t){e.$Modal.error({title:"提示",content:t.data.msg})})}}}},changePage:function(t){this.table.page=t,this.getSubject()},getSubject:function(){var t=this,e={page:this.table.page,pagesize:1e4,is_show:0};this.$post(this.PATH.PC_LESSONS,e).then(function(e){t.subjectList=[],0==e.data.errno?t.subjectList=e.data.data:t.$Modal.error({width:360,content:e.data.errmsg})})},getgroups:function(){var t=this,e={page:this.table.page,pagesize:this.table.pagesize};this.$post(this.PATH.PC_FREE_LESSONS,e).then(function(e){0===e.data.errno?(t.table.total=e.data.count,t.table.data=e.data.data):t.$Modal.error({width:360,content:e.data.errmsg})})},changeStatus:function(t,e){var a=this;this.$http.post(this.PATH.OPEN_FREE_LESSON,{lesson_id:t}).then(function(t){0===t.data.errno?a.getgroups():(a.getgroups(),a.$Modal.error({width:360,content:t.data.msg}))})},showEditModal:function(t,e){this.formValidate.type=t,"new"==t?(this.$refs.formValidate.resetFields(),this.formValidate.subject="",this.formValidate.title="",this.formValidate.sort=""):(this.formValidate.subject=e.title,this.formValidate.title=e.title,this.formValidate.sort=e.free_sort_num.toString(),this.formValidate.lid=e.lesson_id),this.editModal=!0},submitForm:function(t){var e=this,a=void 0;for(var i in this.formValidate.subject=this.formValidate.subject.toString(),this.subjectList)this.subjectList[i].title===this.formValidate.subject&&(a=this.subjectList[i].id);this.$refs[t].validate(function(t){if(t){var i=e.formValidate.type,n=void 0,o=new Object;"new"==i?(n=e.PATH.ADD_FREE_LESSON,o={lesson_id_list:[a],title:e.formValidate.title,free_sort_num:e.formValidate.sort}):(n=e.PATH.UPDATE_FREE_LESSON,o={lesson_id:e.formValidate.lid,title:e.formValidate.title,free_sort_num:e.formValidate.sort,min_pic:e.formValidate.pic?e.formValidate.pic:e.min_pic}),e.$post(n,o).then(function(t){e.formValidate.type,e.$Modal.success({title:"提示",content:t.data.errmsg,onOk:function(){e.editModal=!1}}),e.getgroups()})}else e.$Message.error("Fail!")})}},created:function(){this.getgroups(),this.getSubject()}},n={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:"freeListen"}},[a("div",{staticClass:"h1"},[t._v("今日免费听")]),t._v(" "),a("input",{staticStyle:{display:"none"},attrs:{type:"file",id:"inputFile",accept:"image/gif, image/jpeg, image/png, image/jpg"},on:{change:function(e){t.onUpload(e)}}}),t._v(" "),a("div",{staticClass:"header"},[a("Button",{staticClass:"newbtn zhijian-new-btn",attrs:{type:"primary"},on:{click:function(e){t.showEditModal("new")}}},[t._v("新增")])],1),t._v(" "),a("Table",{staticClass:"zhijian-table account-table",attrs:{stripe:"",columns:t.table.columns,data:t.table.data}}),t._v(" "),a("div",{staticClass:"zhijian-pagination"},[a("Page",{attrs:{total:t.table.total,current:t.table.page,"show-elevator":"",pageSize:t.table.pagesize},on:{"on-change":t.changePage}})],1),t._v(" "),a("Modal",{attrs:{"mask-closable":!1,width:"535","class-name":"ma-edit-modal"},on:{"on-visible-change":t.modalChange},model:{value:t.editModal,callback:function(e){t.editModal=e},expression:"editModal"}},[a("div",{staticClass:"edit-modal-body"},[a("Icon",{attrs:{type:"android-close"},on:{click:function(e){t.editModal=!1}}}),t._v(" "),"new"==t.formValidate.type?a("div",{staticClass:"title"},[t._v("新增信息")]):t._e(),t._v(" "),"edit"==t.formValidate.type?a("div",{staticClass:"title"},[t._v("编辑信息")]):t._e(),t._v(" "),a("Form",{ref:"formValidate",attrs:{model:t.formValidate,rules:t.ruleValidate,"label-width":100}},[a("FormItem",{attrs:{label:"排序",prop:"sort"}},[a("Input",{attrs:{type:"text",placeholder:"Enter something..."},model:{value:t.formValidate.sort,callback:function(e){t.$set(t.formValidate,"sort",e)},expression:"formValidate.sort"}})],1),t._v(" "),a("FormItem",{attrs:{label:"选择课程",prop:"subject"}},[a("Select",{attrs:{clearable:"",filterable:""},on:{"on-change":t.handleChange},model:{value:t.formValidate.subject,callback:function(e){t.$set(t.formValidate,"subject",e)},expression:"formValidate.subject"}},t._l(t.subjectList,function(e){return a("Option",{key:e.id,attrs:{value:e.title}},[t._v(t._s(e.title))])}))],1),t._v(" "),"edit"==t.formValidate.type?a("FormItem",{attrs:{label:"修改图片",prop:"pic"}},[a("div",{staticClass:"freeListen_pic"},[""!==t.min_pic?a("img",{attrs:{src:t.min_pic}}):t._e()])]):t._e(),t._v(" "),a("FormItem",{attrs:{label:"标题",prop:"title"}},[a("Input",{attrs:{disabled:"",type:"text",placeholder:"Enter something..."},model:{value:t.formValidate.title,callback:function(e){t.$set(t.formValidate,"title",e)},expression:"formValidate.title"}})],1)],1)],1),t._v(" "),a("div",{staticClass:"zhijian-btn-box"},[a("div",{staticClass:"zhijian-btn-confirm",on:{click:function(e){t.submitForm("formValidate")}}},[t._v("确定")])])])],1)},staticRenderFns:[]};var o=a("VU/8")(i,n,!1,function(t){a("pp9p"),a("W3nr")},"data-v-16a26634",null);e.default=o.exports},pp9p:function(t,e){}});